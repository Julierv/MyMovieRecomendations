<!DOCTYPE html>
<html>
<head>
    <title>Select 3 MOVIES?</title>
    <link rel="stylesheet" href="selection-covers.css">
    <link rel="icon" href="icons/ticket.gif" type="image/gif" >
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div class="banner" id="banner">
        <p>Select 3 Movies You Most Enjoyed</p>
        <div class="button-container">
            <button class="next-button" id="nextButton">Next</button>
        </div>

    </div>
    <div class="content">
        <div class="image-row" id="items-list">
        </div>
    </div>



    <script>
    document.addEventListener('DOMContentLoaded', async () => {
        // Stores the TMDB IDs of selected movies
        let selectedMovieIds = [];

        // Creates each movie card in the grid
        function createItemElement(item) {
            const itemContainer = document.createElement('div');
            itemContainer.className = 'image-container';

            const image = document.createElement('img');
            image.className = 'image';
            image.src = item.image_url;
            image.alt = item.name;

            // Store tmdb_id inside the image element as a data attribute
            image.dataset.tmdbId = item.tmdb_id;

            const description = document.createElement('div');
            description.className = 'description';
            description.innerHTML = `<h3>${item.name}</h3>`;

            itemContainer.appendChild(image);
            itemContainer.appendChild(description);

            return itemContainer;
        }

        // Fetches movies from backend and sets up the page
        async function fetchData() {
            try {
                // Load 20 random movies
                const response = await fetch('https://35.196.229.17:8080/api/getRandomItems');
                const movies = await response.json();

                const itemsList = document.getElementById('items-list');

                // Render movies
                movies.forEach(movie => {
                    const element = createItemElement(movie);
                    itemsList.appendChild(element);
                });

                const images = document.querySelectorAll('.image');
                const nextButton = document.getElementById('nextButton');

                // Set up selection behavior
                images.forEach(image => {
                    image.addEventListener('click', () => {
                        const tmdbId = Number(image.dataset.tmdbId);

                        // Deselect
                        if (selectedMovieIds.includes(tmdbId)) {
                            selectedMovieIds = selectedMovieIds.filter(id => id !== tmdbId);
                            image.classList.remove('selected');
                            image.nextElementSibling.classList.remove('selected');
                        } 
                        // Select (max 3)
                        else if (selectedMovieIds.length < 3) {
                            selectedMovieIds.push(tmdbId);
                            image.classList.add('selected');
                            image.nextElementSibling.classList.add('selected');
                        }
    
                        // Show "Next" only when exactly 3 are picked
                        nextButton.classList.toggle('show-button', selectedMovieIds.length === 3);
                    });
                });

                // NEXT BUTTON → Send selected IDs → Get AI recs → Store to localStorage → Redirect
                nextButton.addEventListener('click', async () => {
                    if (selectedMovieIds.length !== 3) return;

                    // POST selected IDs to backend
                    const res = await fetch('https://35.196.229.17:8080/api/getAiRecommendations', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ selected: selectedMovieIds }),
                    });

                    const recommendations = await res.json();
                    

                    // Store results locally for the next page
                    localStorage.setItem('recommendations', JSON.stringify(recommendations));
                    localStorage.setItem('selectedIds', JSON.stringify(selectedMovieIds));

                    // Navigate to recommendation page
                    window.location.href = 'recomendation.html';
                });

            } catch (error) {
                console.error("Error loading movies:", error);
            }
        }

        // Run the main loader
        fetchData();
    });
    </script>

    <script>
        const banner = document.getElementById('banner');

        window.addEventListener('scroll', () => {
            const scrollPosition = window.scrollY;
            const maxScroll = 100;
            const opacity = Math.min(1, scrollPosition / maxScroll);

            // adjusted opacity when scrolling down
            banner.style.backgroundColor = `rgba(0, 0, 0, 0.9)`;
        });
    </script>
</body>
</html>





